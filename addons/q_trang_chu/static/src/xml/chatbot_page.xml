<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <!-- Chatbot Full Page Interface -->
    <t t-name="q_trang_chu.ChatbotPage" owl="1">
        <div class="o_chatbot_page">
            
            <!-- Sidebar - Lá»‹ch sá»­ há»™i thoáº¡i -->
            <div t-attf-class="o_chatbot_sidebar {{state.showSidebar ? '' : 'collapsed'}}">
                <div class="o_sidebar_header">
                    <h4>ðŸ’¬ Chat</h4>
                    <button class="o_new_chat_btn" t-on-click="startNewConversation" title="Cuá»™c há»™i thoáº¡i má»›i">
                        <i class="fa fa-plus"/>
                    </button>
                </div>
                
                <div class="o_sidebar_list">
                    <t t-if="state.conversations.length === 0">
                        <div class="o_sidebar_empty">
                            ChÆ°a cÃ³ cuá»™c há»™i thoáº¡i nÃ o
                        </div>
                    </t>
                    <t t-foreach="state.conversations" t-as="conv" t-key="conv.id">
                        <div class="o_sidebar_item" t-on-click="() => loadConversation(conv)">
                            <div class="o_sidebar_avatar">ðŸ¤–</div>
                            <div class="o_sidebar_info">
                                <div class="o_sidebar_title" t-esc="conv.name || 'Cuá»™c há»™i thoáº¡i'"/>
                                <div class="o_sidebar_time" t-esc="formatDate(conv.write_date)"/>
                            </div>
                        </div>
                    </t>
                </div>
            </div>

            <!-- Main Chat Area -->
            <div class="o_chatbot_main">
                <!-- Header -->
                <div class="o_chat_header">
                    <button class="o_toggle_sidebar" t-on-click="toggleSidebar">
                        <i class="fa fa-bars"/>
                    </button>
                    <div class="o_chat_header_avatar">ðŸ¤–</div>
                    <div class="o_chat_header_info">
                        <div class="o_chat_header_name">AI Assistant</div>
                        <div class="o_chat_header_status">
                            <span class="o_status_dot"></span>
                            Trá»±c tuyáº¿n 24/7
                        </div>
                    </div>
                </div>

                <!-- Messages -->
                <div class="o_chat_messages" t-ref="messages">
                    <t t-foreach="state.messages" t-as="msg" t-key="msg.id">
                        <div t-attf-class="o_message {{msg.isUser ? 'is_user' : 'is_bot'}}">
                            <div class="o_message_avatar">
                                <t t-if="msg.isUser">ðŸ˜Š</t>
                                <t t-else="">ðŸ¤–</t>
                            </div>
                            <div class="o_message_content">
                                <div class="o_message_bubble" t-raw="msg.content"/>
                                <div class="o_message_time" t-esc="msg.timestamp"/>
                                
                                <!-- Welcome Options -->
                                <t t-if="msg.showOptions">
                                    <div class="o_message_options">
                                        <t t-foreach="welcomeOptions" t-as="opt" t-key="opt_index">
                                            <button class="o_option_btn" t-on-click="() => sendQuickOption(opt)">
                                                <span class="o_option_icon" t-esc="opt.icon"/>
                                                <span class="o_option_text">
                                                    <strong t-esc="opt.label"/>
                                                    <small t-esc="opt.desc"/>
                                                </span>
                                            </button>
                                        </t>
                                    </div>
                                </t>

                                <!-- Suggestions -->
                                <t t-if="!msg.isUser and msg.suggestions and msg.suggestions.length > 0 and msg_last">
                                    <div class="o_message_suggestions">
                                        <t t-foreach="msg.suggestions" t-as="sug" t-key="sug_index">
                                            <button class="o_suggestion_btn" t-on-click="() => sendSuggestion(sug)">
                                                <t t-esc="sug"/>
                                            </button>
                                        </t>
                                    </div>
                                </t>

                                <!-- Actions -->
                                <t t-if="!msg.isUser and msg.actions and msg.actions.length > 0">
                                    <div class="o_message_actions">
                                        <t t-foreach="msg.actions" t-as="action" t-key="action_index">
                                            <button class="o_action_btn" t-on-click="() => handleAction(action)">
                                                <i class="fa fa-external-link"/>
                                                <t t-esc="action.label"/>
                                            </button>
                                        </t>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </t>

                    <!-- Typing Indicator -->
                    <t t-if="state.isTyping">
                        <div class="o_message is_bot">
                            <div class="o_message_avatar">ðŸ¤–</div>
                            <div class="o_message_content">
                                <div class="o_typing_indicator">
                                    <div class="o_typing_dot"/>
                                    <div class="o_typing_dot"/>
                                    <div class="o_typing_dot"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>

                <!-- Input Area -->
                <div class="o_chat_input_area">
                    <div class="o_input_wrapper">
                        <button class="o_emoji_btn" title="Emoji">ðŸ˜Š</button>
                        <input type="text" 
                               class="o_chat_input"
                               t-att-value="state.inputValue"
                               t-on-input="handleInput"
                               t-on-keypress="handleKeyPress"
                               placeholder="Nháº­p tin nháº¯n..."/>
                        <button class="o_attach_btn" title="ÄÃ­nh kÃ¨m">
                            <i class="fa fa-paperclip"/>
                        </button>
                    </div>
                    <button class="o_send_btn" 
                            t-on-click="() => sendMessage()"
                            t-att-disabled="!state.inputValue || !state.inputValue.trim() || state.isTyping">
                        <i class="fa fa-paper-plane"/>
                    </button>
                </div>
            </div>
        </div>
    </t>

</templates>
